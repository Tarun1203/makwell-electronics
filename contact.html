<!DOCTYPE html>
<html lang="en" data-theme="">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Contact â€¢ MakWell Support</title>
  <meta name="description" content="MakWell â€” product registration, support, repair requests, WhatsApp and email support." />
  <link rel="icon" href="https://raw.githubusercontent.com/Tarun1203/makwell-electronics/main/images/Makwell-logo.png">
  <!-- If you have an external styles.css and theme.js, they will be used -->
  <link rel="stylesheet" href="styles.css" />
  <script defer src="theme.js"></script>

  <style>
    /* Page-local CSS (keeps consistent with your theme) */
    :root { --container: 1100px; }
    body { font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial; margin:0; color:var(--text); background:var(--bg); }
    .container { max-width:var(--container); margin:0 auto; padding:16px; }
    header.site{ border-bottom:1px solid var(--border); background:var(--panel); }
    nav.container{ display:flex; align-items:center; gap:12px; justify-content:space-between; padding:12px 0; }
    .brand { display:flex; gap:10px; align-items:center; text-decoration:none; color:inherit; }
    .brand img{ width:40px; height:40px; object-fit:contain; border-radius:6px; }
    .navlinks { display:flex; gap:10px; align-items:center; }
    .navlinks a { text-decoration:none; color:inherit; padding:6px 8px; border-radius:8px; }
    .navlinks a.active { font-weight:700; }

    main { padding:20px 0; }
    .hero { text-align:center; padding:18px 0; }
    .two { display:grid; grid-template-columns:1.2fr .8fr; gap:18px; }
    @media (max-width:900px){ .two { grid-template-columns:1fr } }

    .card { background:var(--panel); border:1px solid var(--border); border-radius:12px; padding:16px; box-shadow:var(--shadow); }
    label { display:block; font-weight:600; margin-top:8px; margin-bottom:6px; font-size:14px; }
    input[type="text"], input[type="tel"], input[type="email"], select, textarea, input[type="date"] {
      width:100%; padding:10px 12px; border-radius:8px; border:1px solid var(--border); background:transparent; color:inherit; font:inherit;
    }
    textarea { resize:vertical; min-height:90px; }

    .btn { display:inline-block; background:var(--accent); color:#fff; padding:10px 14px; border-radius:10px; border:0; cursor:pointer; font-weight:700; }
    .btn.secondary { background:transparent; color:inherit; border:1px solid var(--border); }
    .note { font-size:13px; color:var(--muted); margin-top:8px; }

    .result { margin-top:12px; padding:12px; border-radius:10px; border:1px solid var(--border); background: color-mix(in oklab,var(--accent) 6%, var(--bg)); }
    .success { color:green; font-weight:700; }
    .error { color:#b00020; font-weight:700; }

    footer.site{ text-align:center; padding:26px 12px; border-top:1px solid var(--border); margin-top:24px; }
    .small { font-size:13px; color:var(--muted); }

    /* small helpers */
    .row { display:flex; gap:10px; }
    .col { flex:1; }
  </style>
</head>
<body>
  <header class="site">
    <nav class="container" aria-label="Main navigation">
      <a class="brand" href="index.html" aria-label="MakWell home">
        <img src="https://raw.githubusercontent.com/Tarun1203/makwell-electronics/main/images/Makwell-logo.png" alt="MakWell logo">
        <div>
          <div style="font-weight:800">MakWell</div>
          <div class="small">â€” Make it Happen</div>
        </div>
      </a>

      <div class="navlinks" role="navigation" aria-label="Top links">
        <a href="index.html">Home</a>
        <a href="products.html">Products</a>
        <a href="about.html">About</a>
        <a href="contact.html" class="active">Contact</a>
        <button id="themeToggle" aria-label="Toggle theme" onclick="toggleTheme()">ðŸŒ“</button>
      </div>
    </nav>
  </header>

  <main class="container">
    <section class="hero">
      <h1 style="margin:4px 0">Need help? Submit a request</h1>
      <p class="small muted" style="max-width:760px;margin:6px auto 0">
        Product registration, product support, and repair requests â€” use the form below. Product Support applies only when under warranty.
      </p>
    </section>

    <section style="margin-top:18px">
      <div class="two">
        <!-- Form -->
        <form id="supportForm" class="card" autocomplete="on" novalidate>
          <h2 style="margin:0 0 8px">Create ticket</h2>

          <label for="type">Request Type</label>
          <select id="type" required>
            <option value="">Select request type</option>
            <option>Product Registration</option>
            <option>Product Support</option>
            <option>Repair Request</option>
          </select>

          <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
            <div>
              <label for="customer">Customer name</label>
              <input id="customer" type="text" placeholder="Full name" required>
            </div>
            <div>
              <label for="phone">Phone</label>
              <input id="phone" type="tel" placeholder="10-digit mobile" pattern="[0-9]{10}" required>
            </div>
          </div>

          <label for="email">Email (optional)</label>
          <input id="email" type="email" placeholder="name@example.com">

          <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
            <div>
              <label for="category">Product category</label>
              <select id="category" required>
                <option value="">Select category</option>
                <option>Televisions</option>
                <option>Washing Machines</option>
                <option>Stabilizers</option>
              </select>
            </div>
            <div>
              <label for="model">Model</label>
              <input id="model" type="text" placeholder='e.g., 43" webOS' required>
            </div>
          </div>

          <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
            <div>
              <label for="serial">Serial no. (optional)</label>
              <input id="serial" type="text" placeholder="Serial number">
            </div>
            <div>
              <label for="purchaseDate">Purchase date (optional)</label>
              <input id="purchaseDate" type="date">
            </div>
          </div>

          <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
            <div>
              <label for="warranty">Under warranty</label>
              <select id="warranty" required>
                <option value="">Select</option>
                <option>Yes</option>
                <option>No</option>
              </select>
            </div>
            <div>
              <label for="issueType">Issue type (optional)</label>
              <select id="issueType">
                <option value="">â€”</option>
                <option>Installation</option>
                <option>Usage Help</option>
                <option>Connectivity</option>
                <option>No Power</option>
                <option>Physical Damage</option>
                <option>Noise/Vibration</option>
                <option>Other</option>
              </select>
            </div>
          </div>

          <label for="issue">Issue description (optional)</label>
          <textarea id="issue" placeholder="Short description of the issue"></textarea>

          <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
            <div>
              <label for="city">City</label>
              <input id="city" type="text" placeholder="City">
            </div>
            <div>
              <label for="state">State</label>
              <input id="state" type="text" placeholder="State">
            </div>
          </div>

          <div style="margin-top:12px;display:flex;gap:10px;align-items:center;flex-wrap:wrap">
            <button id="submitBtn" class="btn" type="submit">Create ticket</button>
            <button type="reset" class="btn secondary">Clear</button>
            <div id="formNote" class="note" aria-live="polite"></div>
          </div>

          <div id="ticketResult" class="result" style="display:none" aria-live="polite">
            <div><strong id="ticketHeadline"></strong></div>
            <div id="ticketInfo" class="small muted" style="margin-top:8px"></div>
            <div style="margin-top:10px;display:flex;gap:8px;flex-wrap:wrap">
              <a id="openWhatsApp" class="btn" target="_blank" rel="noopener">Open WhatsApp</a>
              <a id="openEmail" class="btn secondary" target="_blank" rel="noopener">Open Email</a>
              <button id="copyCallId" class="btn secondary">Copy Call ID</button>
            </div>
          </div>
        </form>

        <!-- Quick contacts -->
        <aside class="card">
          <h3 style="margin:0 0 8px">Quick contacts</h3>
          <p class="small muted" style="margin:0 0 10px">For orders / live chat / general support use:</p>
          <p style="margin:0 0 8px"><strong>Orders / Live Chat / WhatsApp:</strong><br><a href="https://api.whatsapp.com/send?phone=919980000515" target="_blank">+91 99800 00515</a></p>
          <p style="margin:0 0 8px"><strong>Service / Repair / Registration:</strong><br><a href="https://api.whatsapp.com/send?phone=919482844677" target="_blank">+91 94828 44677</a></p>
          <p style="margin:0 0 8px"><strong>Email:</strong><br><a href="mailto:makwellindia456@gmail.com">makwellindia456@gmail.com</a></p>
          <hr style="margin:12px 0">
          <p class="small muted">Support hours: Monâ€“Sat, 9:30 AM â€“ 6:30 PM</p>
        </aside>
      </div>
    </section>
  </main>

  <footer class="site">
    <div class="container small muted">Â© <span id="year"></span> MakWell â€” Make it Happen.</div>
  </footer>

  <script>
    // CONFIG â€” set these to your values
    const GAS_ENDPOINT = "https://script.google.com/macros/s/AKfycbyPsg7-re-YDPTyPUuxIHnwW1HBrssztbLOca3JvguyIBlCOK5EhwNohYdGsqkcK-Gy/exec";
    const WEB_SECRET = "REPLACE_WITH_YOUR_SECRET"; // <<-- replace this with the exact SECRET in Apps Script properties
    const OPS_WHATSAPP = "919482844677";   // service/support whatsapp
    const ORDERS_WHATSAPP = "919980000515"; // orders/livechat

    document.getElementById('year').textContent = new Date().getFullYear();

    // Small helpers
    function prefixFor(type){
      if(!type) return "XX";
      if(type.includes("Registration")) return "PR";
      if(type.includes("Support")) return "PS";
      if(type.includes("Repair")) return "RR";
      return "XX";
    }
    function pad3(n){ return String(n).padStart(3,'0'); }
    function twoDigitYear(){ return new Date().getFullYear().toString().slice(-2); }

    // WhatsApp URL builder (api.whatsapp.com recommended)
    function buildWhatsAppLink(phone, obj){
      const p = String(phone||"").replace(/\D/g,'');
      const lines = [
        `Call ID: ${obj.callId}`,
        `Type: ${obj.type}`,
        `Name: ${obj.customer}`,
        `Phone: +91 ${obj.phone}`,
        `Category: ${obj.category || '-'}`,
        `Model: ${obj.model || '-'}`,
        `Serial: ${obj.serial || '-'}`,
        `Under Warranty: ${obj.warranty || '-'}`,
        `Issue: ${obj.issue || '-'}`,
        `City/State: ${obj.city || '-'} / ${obj.state || '-'}`
      ];
      return `https://api.whatsapp.com/send?phone=${p}&text=${encodeURIComponent(lines.join("\n"))}`;
    }

    function buildMailTo(obj){
      const sub = `New ${obj.type} Ticket ${obj.callId}`;
      const body = [
        `Call ID: ${obj.callId}`,
        `Type: ${obj.type}`,
        `Name: ${obj.customer}`,
        `Phone: +91 ${obj.phone}`,
        `Email: ${obj.email || '-'}`,
        `Category: ${obj.category || '-'}`,
        `Model: ${obj.model || '-'}`,
        `Serial: ${obj.serial || '-'}`,
        `Under Warranty: ${obj.warranty || '-'}`,
        `Issue Type: ${obj.issueType || '-'}`,
        `Issue: ${obj.issue || '-'}`,
        `City/State: ${obj.city || '-'} / ${obj.state || '-'}`
      ].join("\n");
      return `mailto:makwellindia456@gmail.com?subject=${encodeURIComponent(sub)}&body=${encodeURIComponent(body)}`;
    }

    // Form logic
    (function(){
      const form = document.getElementById('supportForm');
      const formNote = document.getElementById('formNote');
      const ticketResult = document.getElementById('ticketResult');
      const ticketHeadline = document.getElementById('ticketHeadline');
      const ticketInfo = document.getElementById('ticketInfo');
      const openWhatsApp = document.getElementById('openWhatsApp');
      const openEmail = document.getElementById('openEmail');
      const copyCallId = document.getElementById('copyCallId');

      // Live warning: product support selected but warranty no
      const typeEl = document.getElementById('type');
      const warrantyEl = document.getElementById('warranty');
      function maybeWarn(){
        const t = typeEl.value, w = warrantyEl.value;
        if(t === 'Product Support' && w && w !== 'Yes'){
          formNote.textContent = "Product Support requires warranty = Yes â€” this will be logged as Repair Request.";
        } else formNote.textContent = "";
      }
      typeEl.addEventListener('change', maybeWarn);
      warrantyEl.addEventListener('change', maybeWarn);

      form.addEventListener('submit', async function(e){
        e.preventDefault();
        ticketResult.style.display = 'none';
        formNote.textContent = "Submittingâ€¦";

        // Gather
        const data = {
          type: (document.getElementById('type').value || '').trim(),
          customer: (document.getElementById('customer').value || '').trim(),
          phone: (document.getElementById('phone').value || '').trim(),
          email: (document.getElementById('email').value || '').trim(),
          category: (document.getElementById('category').value || '').trim(),
          model: (document.getElementById('model').value || '').trim(),
          serial: (document.getElementById('serial').value || '').trim(),
          purchaseDate: (document.getElementById('purchaseDate').value || '').trim(),
          warranty: (document.getElementById('warranty').value || '').trim(),
          issueType: (document.getElementById('issueType').value || '').trim(),
          issue: (document.getElementById('issue').value || '').trim(),
          city: (document.getElementById('city').value || '').trim(),
          state: (document.getElementById('state').value || '').trim(),
          source: 'Web Form',
          secret: WEB_SECRET
        };

        // Client-side routing: if user asked for Product Support but not under warranty, switch to Repair Request
        if(data.type === 'Product Support' && data.warranty !== 'Yes') {
          data.type = 'Repair Request';
        }

        // show provisional local id while server returns real one
        const pref = prefixFor(data.type);
        // create a quick provisional local id (not used by server)
        const localCount = Math.floor(Math.random()*900) + 1;
        const provisionalId = `${twoDigitYear()}/MK-${pref}-${pad3(localCount)}`;
        ticketHeadline.textContent = 'Creating ticketâ€¦';
        ticketInfo.textContent = `Provisional ID: ${provisionalId}`;
        ticketResult.style.display = 'block';

        // POST to Apps Script
        let serverCallId = null;
        try {
          const r = await fetch(GAS_ENDPOINT, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(data)
          });
          const j = await r.json().catch(()=>({ok:false}));
          if(j && j.ok && j.callId){
            serverCallId = j.callId;
          } else {
            console.warn('Server responded with:', j);
          }
        } catch(err) {
          console.warn('Save to Sheets failed', err);
        }

        const finalId = serverCallId || provisionalId;
        ticketHeadline.textContent = 'Ticket created';
        ticketInfo.textContent = `ID: ${finalId} â€¢ ${data.type}`;
        formNote.textContent = '';

        // Build action URLs
        const waTo = (data.type && data.type.toLowerCase().includes('order')) ? ORDERS_WHATSAPP : OPS_WHATSAPP;
        openWhatsApp.href = buildWhatsAppLink(waTo, {...data, callId: finalId});
        openEmail.href = buildMailTo({...data, callId: finalId});

        // copy
        copyCallId.onclick = () => {
          navigator.clipboard?.writeText(finalId).then(()=> {
            copyCallId.textContent = 'Copied âœ“';
            setTimeout(()=> copyCallId.textContent = 'Copy Call ID', 1800);
          }).catch(()=> alert('Copy failed â€” Call ID: ' + finalId));
        };

        // Optionally: auto-open WhatsApp (commented out)
        // window.open(openWhatsApp.href, '_blank');

        // Optionally clear form
        // form.reset();

      });
    })();
  </script>
</body>
</html>
